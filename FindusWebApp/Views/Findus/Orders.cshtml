@model FindusWebApp.Models.OrderViewModel

@{

    var OrderSelect = @Model?.OrderSelect;
    var Invoice = @Model?.Invoice;


    System.Globalization.CultureInfo Swe = new System.Globalization.CultureInfo("sv-SE");

    string TotalDebit = @Model.TotalDebit != null ? ((decimal)@Model.TotalDebit).ToString("N2", Swe) : null;
    string TotalCredit = @Model.TotalCredit != null ?((decimal)@Model.TotalCredit).ToString("N2", Swe) : null;
}

<div class="form-group">
    <div class="center-block">
        <partial name="Partial/DateRangePicker" />
    </div>
    @if (@Model != null)
    {

        @if (Invoice != null)
        {
            @if (TotalDebit != null || TotalCredit != null)
            {
                <table class="Grid" style="width: 50%" cellpadding="0" cellspacing="0">
                    <tr>
                        <th>Total Debet</th>
                        <th>Total Kredit</th>
                    </tr>
                    <tr>
                        <td style="max-width: 100px;">
                            @($"{TotalDebit} Kr")
                        </td>
                        <td style="max-width: 100px;">
                            @($"{TotalCredit} Kr")
                        </td>
                    </tr>
                </table>
            }
            <partial name="Partial/InvoiceAccrual" model="Invoice" />
        }

        @if (OrderSelect != null)
        {
            <table class="Grid" cellpadding="0" cellspacing="0">
                <tr>
                    <th></th>
                    <th scope="col">Order</th>
                    <th scope="col">Select</th>
                </tr>
                @foreach (var order in Model.OrderSelect)
                {
                    var invoice = @Model.GetInvoice(order.Value);
                    string error = @Model.GetError(order.Value);

                    <tr>
                        <td style="width: 40px">
                            <img src="~/images/plus.png" id="@order.Value" style="width: 100%" />
                        </td>

                        <td>
                            @Html.ActionLink(order.Text,"Verification", "Findus", new {orderId = order.Value})
                            <div class="text-danger">@Html.Raw(System.Web.HttpUtility.HtmlEncode(error))</div>
                        </td>
                        <td><input type='checkbox' value='false' /></td>
                    </tr>
                    <tr>
                        <td></td>
                            <td colspan="999">
                                <div style="display:none" id="inv-@order.Value">
                                    @if(error == null) {
                                        @Html.Partial("Partial/InvoiceAccrual", invoice)
                                    } else {
                                        @Html.Partial("DisplayTemplates/Order", @Model.GetOrder(order.Value))
                                    }
                                </div>
                            </td>
                    </tr>
                }
            </table>
        }
    }
</div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {

        $('tr:has("td:empty")').hide();

        $("body").on("click", "img[src*='plus.png']", function () {
            var orderId = $(this).attr("id");
            var div = document.getElementById("inv-" + orderId);
            div.style.display = "block"

            $(this).closest("tr").next().show();
            $(this).attr("src", "/images/minus.png")
        });
        $("body").on("click", "img[src*='minus.png']", function () {
            var orderId = $(this).attr("id");
            var div = document.getElementById("inv-" + orderId);
            div.style.display = "none"
            $(this).closest("tr").next().hide();
            $(this).attr("src", "/images/plus.png")
        });
    });
</script>